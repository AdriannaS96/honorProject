{{> header}}

<div class="container my-5">
  <div class="row">

    <!-- LEFT: IMAGES -->
    <div class="col-md-6">

      {{#listing.images.length}}
      <div id="listingCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
          {{#listing.images}}
          <div class="carousel-item {{#isFirst}}active{{/isFirst}}">
            <img
              src="{{url}}"
              class="d-block w-100 img-fluid rounded"
              alt="{{../listing.title}}"
            >
          </div>
          {{/listing.images}}
        </div>

        <!-- prev / next -->
        <button class="carousel-control-prev" type="button"
                data-bs-target="#listingCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon"></span>
          <span class="visually-hidden">Previous</span>
        </button>

        <button class="carousel-control-next" type="button"
                data-bs-target="#listingCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon"></span>
          <span class="visually-hidden">Next</span>
        </button>

        <!-- thumbnails -->
        <div class="d-flex justify-content-center mt-3">
          {{#listing.images}}
          <img
            src="{{url}}"
            class="img-thumbnail mx-1 thumb-img"
            style="width:60px; cursor:pointer;"
            data-bs-target="#listingCarousel"
            data-bs-slide-to="{{@index}}"
          />
          {{/listing.images}}
        </div>
      </div>
      {{/listing.images.length}}

      {{^listing.images.length}}
        <img
          src="/images/default-house.jpg"
          alt="No Image"
          class="img-fluid rounded"
        >
      {{/listing.images.length}}

    </div>

    <!-- RIGHT: DETAILS -->
    <div class="col-md-6">
      <h1>{{listing.title}}</h1>
      <p class="text-muted">{{listing.location}}</p>
      <h3 class="fw-bold">Â£{{listing.price}}</h3>
      <p>{{listing.description}}</p>
      <p>
        Status:
        <span class="badge bg-info">{{listing.status}}</span>
      </p>

      <!-- OWNER ACTIONS -->
      {{#user}}
        {{#listing.isOwner}}
          <a
            href="/dashboard/landlord/edit/{{listing._id}}"
            class="btn btn-warning me-2"
          >
            Edit Listing
          </a>

          <a
            href="/dashboard/landlord/delete/{{listing._id}}"
            class="btn btn-danger"
          >
            Delete Listing
          </a>
        {{/listing.isOwner}}
      {{/user}}

      <!-- SAVE / UNSAVE (ONLY TENANT) -->
      {{#isTenant}}

        {{^listing.isSaved}}
        <form
          method="POST"
          action="/listing/{{listing._id}}/save"
          class="d-inline"
        >
          <input type="hidden" name="action" value="save">
            <button
            type="submit"
            class="btn btn-outline-danger mt-3 favorite-button"
            aria-label="Save listing"
          >
            <i class="fa-regular fa-heart" aria-hidden="true"></i>
          </button>
        </form>
        {{/listing.isSaved}}

        {{#listing.isSaved}}
        <form
          method="POST"
          action="/listing/{{listing._id}}/save"
          class="d-inline"
        >
          <input type="hidden" name="action" value="unsave">
                    <button
            type="submit"
            class="btn btn-danger mt-3 favorite-button"
            aria-label="Remove from saved listings"
          >
            <i class="fa-solid fa-heart" aria-hidden="true"></i>
          </button>
        </form>
        {{/listing.isSaved}}

      {{/isTenant}}

      <!-- CONTACT -->
      <a
        href="/dashboard/messages/{{listing.landlord}}"
        class="btn btn-primary mt-3"
      >
        Contact Landlord
      </a>

    </div>
  </div>
  <div class="row mt-5">
    <div class="col-12">
      <h2 class="h4">Explore the Area</h2>
      <p class="text-muted mb-3">
        Map preview for {{listing.location}}{{#listing.area}}, {{listing.area}}{{/listing.area}}{{#listing.postcode}} {{listing.postcode}}{{/listing.postcode}}.
      </p>
      <div
        id="listing-map"
        class="listing-map rounded"
        data-location="{{listing.location}}"
        data-area="{{listing.area}}"
        data-postcode="{{listing.postcode}}"
      ></div>
      <p id="listing-map-status" class="small text-muted mt-2" aria-live="polite"></p>
    </div>
  </div>
</div>

{{> footer}}

<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin=""
></script>
<script src="/js/listing-carousel.js"></script>
<script src="/js/listing-map.js"></script>
