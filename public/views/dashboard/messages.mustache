{{> header}}

<div class="dashboard-container">

  <!-- SIDEBAR -->
  <nav class="sidebar">
    <h4 class="sidebar-title">Tenant</h4>

    <ul class="nav flex-column">
      <li class="nav-item">
        <a class="nav-link" href="/dashboard/tenant_dashboard">
          <i class="bi bi-speedometer2"></i>
          Dashboard
        </a>
      </li>

      <li class="nav-item">
        <a class="nav-link" href="/dashboard/applications">
          <i class="bi bi-file-earmark-text"></i>
          Applications
        </a>
      </li>

      <li class="nav-item">
        <a class="nav-link active" href="/dashboard/messages">
          <i class="bi bi-chat-dots"></i>
          Messages
        </a>
      </li>
          <!-- My Account -->
    <li class="nav-item">
      <a class="nav-link" href="/account">
        <i class="bi bi-person"></i>
        My Account
      </a>
    </li>
      <li class="nav-item mt-3">
        <a class="nav-link text-danger" href="/logout">
          <i class="bi bi-box-arrow-right"></i>
          Logout
        </a>
      </li>
    </ul>
  </nav>

  <!-- MAIN CONTENT -->
  <main class="main-content">

    <div class="dashboard-header">
      <h2>Messages ðŸ’¬</h2>
      <p class="text-muted">Chat with landlords and tenants</p>
    </div>

    <div class="messages-wrapper">

      <!-- CONVERSATIONS LIST -->
      <div class="conversations-panel">
        <h5 class="fw-bold p-3 mb-0">Conversations</h5>

        <ul class="conversation-list">
          {{#conversations}}
          <li class="conversation-item {{#isActive}}active{{/isActive}}">
            <a
              href="/dashboard/messages/{{nickname}}"
              class="d-flex align-items-center gap-2 text-decoration-none text-dark"
            >
              <div class="avatar">{{initials}}</div>
              <div>{{nickname}}</div>
            </a>
          </li>
          {{/conversations}}

          {{^conversations}}
          <li class="text-muted p-3">
            No conversations yet
          </li>
          {{/conversations}}
        </ul>
      </div>

      <!-- CHAT PANEL -->
      <div class="chat-panel">

        <div class="chat-header">
          {{#activeChat}}
            <strong>Chat with {{activeChat}}</strong>
          {{/activeChat}}

          {{^activeChat}}
            <strong>New message</strong>
          {{/activeChat}}
        </div>

        <div class="chat-messages">

          {{#messages}}
          <div class="message {{#isMine}}mine{{/isMine}}">
            <div class="message-content">
              {{content}}
            </div>
            <small class="text-muted">{{timestamp}}</small>
          </div>
          {{/messages}}

          {{^messages}}
          <div class="text-muted text-center mt-4">
            Select a conversation or send a new message
          </div>
          {{/messages}}

        </div>

        <form
          class="chat-input"
          method="POST"
          action="/dashboard/messages/send"
        >
          {{^activeChat}}
          <input
            type="text"
            name="to"
            class="form-control mb-2"
            placeholder="Recipient nickname"
            required
          >
          {{/activeChat}}

          {{#activeChat}}
          <input type="hidden" name="to" value="{{activeChat}}">
          {{/activeChat}}

          <input
            type="text"
            name="content"
            class="form-control"
            placeholder="Type a message..."
            required
          >

          <button class="btn btn-primary mt-2 w-100">
            Send
          </button>
        </form>

      </div>

    </div>

  </main>
</div>

{{> footer}}

<link
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
  rel="stylesheet"
/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
