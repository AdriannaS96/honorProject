{{> header}}

<div class="dashboard-container">

  <!-- SIDEBAR -->
  <nav class="sidebar">
    <h4 class="sidebar-title">Landlord</h4>
    <ul class="nav flex-column">
      <li class="nav-item">
        <a class="nav-link" href="/dashboard/landlord_dashboard">
          <i class="bi bi-speedometer2"></i>
          Dashboard
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/dashboard/landlord/my_listings">
          <i class="bi bi-house-door"></i>
          My Listings
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/dashboard/landlord/add_listing">
          <i class="bi bi-plus-circle"></i>
          Add Listing
        </a>
      </li>
      <li class="nav-item mt-3">
        <a class="nav-link text-danger" href="/logout">
          <i class="bi bi-box-arrow-right"></i>
          Logout
        </a>
      </li>
    </ul>
  </nav>

  <!-- MAIN -->
  <main class="main-content">

    <!-- Header -->
    <div class="mb-4">
      <h1 class="fw-bold">Edit Listing</h1>
      <p class="text-muted mb-0">
        Update your property details
      </p>
    </div>

    <!-- Form -->
    <div class="add-listing-card">

      <form
        action="/dashboard/landlord/edit/{{listing._id}}"
        method="POST"
        enctype="multipart/form-data"
      >

        <div class="row g-4">

          <!-- Title -->
          <div class="col-md-6">
            <label class="form-label">Listing Title</label>
            <input
              type="text"
              name="title"
              class="form-control"
              value="{{listing.title}}"
              required
            >
          </div>

          <!-- Location -->
          <div class="col-md-6">
            <label class="form-label">Location</label>
            <input
              type="text"
              name="location"
              class="form-control"
              value="{{listing.location}}"
              required
            >
          </div>

          <!-- Status -->
          <div class="col-md-6">
            <label class="form-label">Status</label>
            <select name="status" class="form-select" required>
              <option value="active" {{#listingActive}}selected{{/listingActive}}>Active</option>
              <option value="pending" {{#listingPending}}selected{{/listingPending}}>Pending</option>
              <option value="inactive" {{#listingInactive}}selected{{/listingInactive}}>Inactive</option>
            </select>
          </div>

          <!-- Price -->
          <div class="col-md-6">
            <label class="form-label">Monthly Rent (Â£)</label>
            <input
              type="number"
              name="price"
              class="form-control"
              value="{{listing.price}}"
              required
            >
          </div>

          <!-- Description -->
          <div class="col-12">
            <label class="form-label">Description</label>
            <textarea
              name="description"
              rows="4"
              class="form-control"
              required
            >{{listing.description}}</textarea>
          </div>

          <!-- Existing images -->
          <div class="col-12">
            <label class="form-label">Current Images</label>

            <div class="d-flex flex-wrap gap-2 mb-2">
              {{#listing.images}}
                <img
                  src="{{url}}"
                  alt="Listing image"
                  style="width:120px;height:90px;object-fit:cover;border-radius:8px;border:1px solid #ddd;"
                >
              {{/listing.images}}

              {{^listing.images}}
                <p class="text-muted">No images uploaded yet</p>
              {{/listing.images}}
            </div>
          </div>

          <!-- Upload new images -->
          <div class="col-12">
            <label class="form-label">Add New Images</label>

            <input
              type="file"
              id="imagesInput"
              name="images"
              accept="image/*"
              multiple
              class="form-control"
            >

            <small class="text-muted">
              New images will be added to existing ones
            </small>
          </div>

          <!-- Preview -->
          <div class="col-12">
            <div
              id="preview"
              class="d-flex flex-wrap gap-2 mt-2"
            ></div>
          </div>

          <!-- Actions -->
          <div class="col-12 d-flex justify-content-end gap-2 mt-3">
            <a
              href="/dashboard/landlord/my_listings"
              class="btn btn-outline-secondary"
            >
              Cancel
            </a>

            <button type="submit" class="btn btn-primary px-4">
              <i class="bi bi-check-lg"></i>
              Save Changes
            </button>
          </div>

        </div>
      </form>

    </div>

  </main>
</div>

{{> footer}}

<!-- Icons -->
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
  rel="stylesheet"
/>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- IMAGE PREVIEW SCRIPT -->
<script>
  const input = document.getElementById("imagesInput");
  const preview = document.getElementById("preview");

  if (input) {
    input.addEventListener("change", () => {
      preview.innerHTML = "";

      Array.from(input.files).forEach(file => {
        const reader = new FileReader();

        reader.onload = e => {
          const img = document.createElement("img");
          img.src = e.target.result;
          img.style.width = "120px";
          img.style.height = "90px";
          img.style.objectFit = "cover";
          img.style.borderRadius = "8px";
          img.style.border = "1px solid #ddd";

          preview.appendChild(img);
        };

        reader.readAsDataURL(file);
      });
    });
  }
</script>
